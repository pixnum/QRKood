<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QRKood - QR Code Generator</title>
<style>
body{background:#e0e0e0;display:flex;justify-content:center;align-items:flex-start;padding:20px;font-family:'Segoe UI',sans-serif;}
.frame{background:#e0e0e0;border-radius:30px;padding:20px;width:100%;max-width:550px;box-shadow:20px 20px 60px #bebebe,-20px -20px 60px #ffffff;}
.dark-mode .frame{background:#2b2b2b;box-shadow:20px 20px 60px #1c1c1c,-20px -20px 60px #383838;color:#e0e0e0;}
h1{text-align:center;margin-bottom:15px;}
label{display:block;margin:10px 0 5px;}
input,select,textarea{width:100%;padding:8px;border-radius:10px;border:none;margin-bottom:10px;outline:none;box-shadow:inset 5px 5px 10px #bebebe,inset -5px -5px 10px #ffffff;}
.dark-mode input, .dark-mode select, .dark-mode textarea{box-shadow:inset 5px 5px 10px #1c1c1c,inset -5px -5px 10px #383838;background:#2b2b2b;color:#e0e0e0;}
button{padding:10px 15px;margin:5px;border-radius:15px;border:none;cursor:pointer;box-shadow:5px 5px 10px #bebebe,-5px -5px 10px #ffffff;}
.dark-mode button{box-shadow:5px 5px 10px #1c1c1c,-5px -5px 10px #383838;background:#3a3a3a;color:#e0e0e0;}
#qrcode-container{margin-top:20px;text-align:center;}
#history{margin-top:20px;width:100%;max-height:250px;overflow-y:auto;padding:10px;border-radius:15px;background:#e0e0e0;box-shadow:inset 5px 5px 10px #bebebe,inset -5px -5px 10px #ffffff;}
.dark-mode #history{background:#2b2b2b;box-shadow:inset 5px 5px 10px #1c1c1c,inset -5px -5px 10px #383838;}
.history-item{padding:8px 10px;border-bottom:1px solid #c0c0c0;cursor:pointer;word-break:break-word;}
.dark-mode .history-item{border-color:#555;}
.history-item:last-child{border-bottom:none;}
</style>
</head>
<body>
<div class="frame">
<h1>QRKood</h1>

<label for="data">Enter Data</label>
<textarea id="data" placeholder="Text, URL etc."></textarea>

<label for="customText">Custom Text Below QR</label>
<input type="text" id="customText">

<label for="size">QR Size (px)</label>
<input type="number" id="size" value="250" min="100" max="600">

<label for="fgColor">Foreground Color</label>
<input type="color" id="fgColor" value="#000000">

<label for="bgColor">Background Color</label>
<input type="color" id="bgColor" value="#ffffff">

<label for="logo">Logo Image URL (Optional)</label>
<input type="text" id="logo" placeholder="Enter URL of small image">

<label for="errorCorrection">Error Correction Level</label>
<select id="errorCorrection">
<option value="L">Low</option>
<option value="M" selected>Medium</option>
<option value="Q">Quartile</option>
<option value="H">High</option>
</select>

<div>
<button id="generate">Generate QR</button>
<button id="download">Download PNG</button>
<button id="toggleDark">Toggle Dark Mode</button>
<button id="clearHistory">Clear History</button>
</div>

<div id="qrcode-container"></div>
<div id="history"></div>
</div>

<script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
<script>
const qrContainer=document.getElementById("qrcode-container");
const generateBtn=document.getElementById("generate");
const downloadBtn=document.getElementById("download");
const toggleDarkBtn=document.getElementById("toggleDark");
const clearHistoryBtn=document.getElementById("clearHistory");
const dataInput=document.getElementById("data");
const sizeInput=document.getElementById("size");
const fgInput=document.getElementById("fgColor");
const bgInput=document.getElementById("bgColor");
const customTextInput=document.getElementById("customText");
const logoInput=document.getElementById("logo");
const errorSelect=document.getElementById("errorCorrection");
const historyDiv=document.getElementById("history");

let darkMode=false;
let historyData=[];

toggleDarkBtn.onclick=()=>{
  darkMode=!darkMode;
  document.body.classList.toggle("dark-mode",darkMode);
  document.querySelector(".frame").classList.toggle("dark-mode",darkMode);
};

function updateHistory(){
  historyDiv.innerHTML="";
  historyData.forEach(item=>{
    const div=document.createElement("div");
    div.className="history-item";
    div.innerText=item;
    div.onclick=()=>{dataInput.value=item;};
    historyDiv.appendChild(div);
  });
}

generateBtn.onclick=()=>{
  const data=dataInput.value.trim();
  if(!data){alert("Enter data"); return;}
  qrContainer.innerHTML="";
  const size=parseInt(sizeInput.value);
  const margin=20; // Quiet zone

  // Generate QR in hidden div
  const tempDiv=document.createElement("div");
  const qr=new QRCode(tempDiv,{
    text:data,
    width:size,
    height:size,
    colorDark:fgInput.value,
    colorLight:bgInput.value,
    correctLevel:QRCode.CorrectLevel[errorSelect.value]
  });

  setTimeout(()=>{
    const qrImg=tempDiv.querySelector("img");
    if(!qrImg) return;

    const canvas=document.createElement("canvas");
    canvas.width=size+margin*2;
    canvas.height=size+margin*2;
    const ctx=canvas.getContext("2d");

    ctx.fillStyle=bgInput.value;
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.drawImage(qrImg, margin, margin, size, size);

    const logoURL=logoInput.value.trim();
    const customText=customTextInput.value.trim();
    if(logoURL){
      const img=new Image();
      img.crossOrigin="anonymous";
      img.src=logoURL;
      img.onload=()=>{
        const logoSize=size*0.2;
        ctx.drawImage(img,(canvas.width-logoSize)/2,(canvas.height-logoSize)/2,logoSize,logoSize);
        displayQRWithText(canvas, customText);
      };
      img.onerror=()=>{displayQRWithText(canvas, customText);}
    }else{displayQRWithText(canvas, customText);}

    historyData.push(data);
    updateHistory();
  },50);
};

function displayQRWithText(canvas, customText){
  qrContainer.innerHTML="";
  const wrapper=document.createElement("div");
  wrapper.id="qr-wrapper";
  wrapper.style.display="inline-block";
  wrapper.style.textAlign="center";

  wrapper.appendChild(canvas);

  if(customText){
    const p=document.createElement("div");
    p.id="custom-text";
    p.style.marginTop="10px";
    p.innerText=customText;
    wrapper.appendChild(p);
  }

  const copyright=document.createElement("div");
  copyright.style.marginTop="6px";
  copyright.style.fontSize="12px";
  copyright.style.color=darkMode ? "#e0e0e0" : "#333";
  copyright.innerText="Â© QRKood 2025";
  wrapper.appendChild(copyright);

  qrContainer.appendChild(wrapper);
}

downloadBtn.onclick=()=>{
  const canvas=qrContainer.querySelector("canvas") || qrContainer.querySelector("img");
  if(canvas){
    const link=document.createElement("a");
    if(canvas.tagName==="IMG") link.href=canvas.src;
    else link.href=canvas.toDataURL("image/png");
    link.download="qrcode.png";
    link.click();
  }else alert("Generate QR first!");
};

clearHistoryBtn.onclick=()=>{
  historyData=[]; updateHistory(); qrContainer.innerHTML=""; dataInput.value=""; customTextInput.value=""; logoInput.value="";
};
</script>
</body>
</html>
